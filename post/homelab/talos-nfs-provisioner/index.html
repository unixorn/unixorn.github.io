<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Using a NFS Provisioner with Talos | unixorn.github.io</title>
<meta name="keywords" content="homelab, k8s, kubernetes, talos, nfs, synology">
<meta name="description" content="I&rsquo;ve been experimenting with running Talos in my home lab. I really like the idea of an immutable OS layer under Kubernetes and wanted to stand up a cluster to run some of my services that are currently run in docker-compose. I decided to use my Synology to store k8s volumes, here&rsquo;s how I set that up">
<meta name="author" content="Me">
<link rel="canonical" href="https://unixorn.github.io/post/homelab/talos-nfs-provisioner/">
<meta name="google-site-verification" content="UA-100853138-2">
<link crossorigin="anonymous" href="https://unixorn.github.io/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css" integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF&#43;13Dyqob6ASlTrTye8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://unixorn.github.io/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="https://unixorn.github.io/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="https://unixorn.github.io/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="https://unixorn.github.io/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="https://unixorn.github.io/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://unixorn.github.io/post/homelab/talos-nfs-provisioner/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://unixorn.github.io/post/homelab/talos-nfs-provisioner/">
  <meta property="og:site_name" content="unixorn.github.io">
  <meta property="og:title" content="Using a NFS Provisioner with Talos">
  <meta property="og:description" content="I’ve been experimenting with running Talos in my home lab. I really like the idea of an immutable OS layer under Kubernetes and wanted to stand up a cluster to run some of my services that are currently run in docker-compose. I decided to use my Synology to store k8s volumes, here’s how I set that up">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-12-12T23:49:23-07:00">
    <meta property="article:modified_time" content="2025-12-12T23:49:23-07:00">
    <meta property="article:tag" content="Homelab">
    <meta property="article:tag" content="K8s">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Talos">
    <meta property="article:tag" content="Nfs">
    <meta property="article:tag" content="Synology">
      <meta property="og:image" content="https://unixorn.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://unixorn.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name="twitter:title" content="Using a NFS Provisioner with Talos">
<meta name="twitter:description" content="I&rsquo;ve been experimenting with running Talos in my home lab. I really like the idea of an immutable OS layer under Kubernetes and wanted to stand up a cluster to run some of my services that are currently run in docker-compose. I decided to use my Synology to store k8s volumes, here&rsquo;s how I set that up">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://unixorn.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Using a NFS Provisioner with Talos",
      "item": "https://unixorn.github.io/post/homelab/talos-nfs-provisioner/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Using a NFS Provisioner with Talos",
  "name": "Using a NFS Provisioner with Talos",
  "description": "I\u0026rsquo;ve been experimenting with running Talos in my home lab. I really like the idea of an immutable OS layer under Kubernetes and wanted to stand up a cluster to run some of my services that are currently run in docker-compose. I decided to use my Synology to store k8s volumes, here\u0026rsquo;s how I set that up\n",
  "keywords": [
    "homelab", "k8s", "kubernetes", "talos", "nfs", "synology"
  ],
  "articleBody": "I’ve been experimenting with running Talos in my home lab. I really like the idea of an immutable OS layer under Kubernetes and wanted to stand up a cluster to run some of my services that are currently run in docker-compose. I decided to use my Synology to store k8s volumes, here’s how I set that up\nI have a Talos cluster running in my proxmox cluster. Because it’s immutable and is managed via API calls with talosctl, using the Synology isn’t as simple as sshing to a kubernetes node and mounting a filesystem.\nPre-requisites helm \u0026 talosctl. I installed them on my M3Book with brew, but you can get other install instructions at helm.sh and the Sidero Labs website An NFS server. I’m using my Synology for this post and including setup instructions for it. There are are many tutorials out there for setting up NFS on Linux so that’s out of scope for this post. A working Talos cluster. I used a single-node one to validate these instructions. The NFS server on my Synology grants access based on the IP of the client machine. I recommend that you either configure your DHCP server to always assign your talos cluster nodes the same IP or assign a static address in your Talos cluster configuration. I prefer to do it on my DHCP server so there’s a single source of truth for IP address assignments in my homelab.\nSet up a NFS share On my Synology, I went to Control Panel -\u003e Shared Folder and created a new shared folder talos-nfs, and enabled NFS on it. Keep track of the complete path to the folder (in my case /volume2/talos-nfs), you’re going to need it later.\nI also created a second share, talos-nfs-retains that I’m going to use for a separate storageClass with a reclaimPolicy of Retains. This one’s path is /volume2/talos-nfs-retains.\nGo to the NFS Permissions tab and create an access rule that allows connections from your talos node’s IP address.\nIt’ll look something like this: Put in the IP address of your talos node. I checked all three of the optional boxes - Enable asynchronous, Allow connections from unprivileged ports and Allow users to access mounted subfolders.\nYou could put in the entire /24 (10.1.2.0/24 in my example) but I don’t recommend it for security reasons. Yes, it’s a homelab and you should trust the other machines on your network, but assigning wide-open access to things “just to get it running” is a really bad habit to get into. Do it right, not right now.\nInstall nfs-subdir-external-provisioner We’re going to use helm to install the nfs-subdir-external-provisioner. I prefer using NFS because then any files the pods write are regular files in a directory tree on the server. This lets me use restic to back them up like I do with my other shares, and I can also move files in or out of the NFS volume without having to crack open an iSCSI volume.\nDepending on your workload it can be a little slower than iSCSI, but my homelab services only have to support two users. Ease of backup is more of a priority for me than performance is.\nAdd the helm repository We’re going to use helm to install the provisioner, so to get started, install the helm repository and do a helm repo update.\nhelm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner \\ \u0026\u0026 helm repo update Install the provisioners My Synology has two bonded ports on 10.0.1.108. nfs.path should be the path being exported from the nfs server, you don’t have to care where talos mounts it.\nThe default is storage class name is nfs-client). I’m using --set storageClass.name=different-nfs-client-name in the helm command below to specify names that would be clear about the reclaim policy.\nI don’t want to accidentally create any volume claims locally if I forget to specify a storageClass, so I made this the default storageClass. Remove the --set storageClass.defaultClass=true argument if you want something else for your default.\nexport NFS_SERVER_IP=YOUR_SERVERS_IP helm install nfs-provisioner-deletes \\ nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \\ --set nfs.server=$NFS_SERVER_IP \\ --set nfs.path=/volume2/talos-nfs \\ --set storageClass.reclaimPolicy=Delete \\ --set storageClass.defaultClass=true \\ --set storageClass.archiveOnDelete=false \\ --set storageClass.name=nfs-client-deletes \\ --set storageClass.onDelete=delete I also added a second storageClass, this time with the reclaimPolicy set to Retains\nhelm install nfs-provisioner-retains \\ nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \\ --set nfs.server=$NFS_SERVER_IP \\ --set nfs.path=/volume2/talos-nfs-retains \\ --set storageClass.name=nfs-client-retains \\ --set storageClass.reclaimPolicy=Retain Confirm that the install succeeded. Check your pods and storage classes with kubectl.\n$ kubectl get pod NAME READY STATUS RESTARTS AGE nfs-provisioner-retains-nfs-subdir-external-provisioner-bc7f6tp 1/1 Running 0 11m nfs-subdir-external-provisioner-745688c67-c27mg 1/1 Running 0 21m $ kubectl get sc NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE nfs-client-deletes (default) cluster.local/nfs-subdir-external-provisioner Delete Immediate true 22m nfs-client-retains cluster.local/nfs-provisioner-retains-nfs-subdir-external-provisioner Retain Immediate true 12m It only took a few seconds for the provisioner pod to come ready. If the provisioner pod never comes ready, check that you have the right IP address in your NFS permissions - when I first set this up I put a .15 where it should have had a .51.\nOnce the nfs-subdir-external-provisioner pod is ready, we can start testing it.\nTest NFS on talos Create a dynamic PVC Create the a yaml file describing the test pvc, debian-tester-pvc-deletes.yaml\n# debian-tester-pvc-deletes.yaml apiVersion: v1 kind: PersistentVolumeClaim metadata: name: debian-test-pvc spec: accessModes: - ReadWriteOnce storageClassName: nfs-client-deletes resources: requests: storage: 5Gi Create the pvc with kubectl.\nkubectl apply -f debian-tester-pvc-deletes.yaml Create a debian deployment that uses the new PVC Create a yaml file for a debian test deployment that attaches the test pvc, debian-pvc-test-deployment.yaml\n# Toy debian deployment apiVersion: apps/v1 kind: Deployment metadata: name: debian-tester-deployment spec: replicas: 1 selector: matchLabels: app: debian-tester template: metadata: labels: app: debian-tester spec: containers: - name: debian-tester-container # Use a standard Debian image image: debian:stable command: [\"/bin/bash\", \"-c\", \"echo 'Data created in PVC' \u003e /mnt/data/testfile.txt; while true; do sleep 30; done;\"] # Mount the volume named 'persistent-storage' to the container path '/mnt/data' volumeMounts: - name: persistent-storage mountPath: /mnt/data volumes: - name: persistent-storage persistentVolumeClaim: claimName: debian-test-pvc And deploy it with\nkubectl apply -f debian-pvc-test-deployment.yaml Confirm our deployment succeeded We should now be able to see our deployment:\n$ kubectl get deployment NAME READY UP-TO-DATE AVAILABLE AGE debian-tester-deployment 1/1 1 1 25s A running pod for it:\nkubectl get pod NAME READY STATUS RESTARTS AGE debian-tester-deployment-77ddd68557-qvcrk 1/1 Running 0 2m24s And finally get a shell in the running pod:\n# Use the pod name from kubectl get pod, in this case DEBIAN_P=debian-tester-deployment-77ddd68557-qvcrk kubectl exec $DEBIAN_P -it -- bash root@debian-tester-deployment-77ddd68557-qvcrk:/# Inside the pod, we can now cd /mnt/data and create some files as a test\ncd /mnt/data echo \"Success\" \u003e pvc-test root@debian-tester-deployment-77ddd68557-qvcrk:/mnt/data# ls pvc-test testfile.txt Confirm it on the NFS server side ssh into your NFS server and cd into the directory you shared. In my case, /volume2/talos-nfs and we can see a directory for the pvc.\ncd /volume2/talos-nfs ls #recycle @eaDir default-debian-test-pvc-pvc-e6cf5df1-90c8-4962-97bb-91ae795945bc /volume2/talos-nfs $ cat default-debian-test-pvc-pvc-e6cf5df1-90c8-4962-97bb-91ae795945bc/pvc-test Success /volume2/talos-nfs $ Persistence test Delete the deployment.\nkubectl delete deployment debian-tester-deployment Create the deployment again.\nkubectl apply -f debian-pvc-test-deployment.yaml Find the new pod with kubectl get pod, and get a shell in it. You’ll see the files you created in /mnt/data\nClean up Delete the deployment\nkubectl delete deployment debian-tester-deployment Delete the pvc\nkubectl delete pvc debian-test-pvc The subdirectory on your NFS server should be gone - ssh in and confirm\ncd /volume2/talos-nfs ls #recycle @eaDir /volume2/talos-nfs $ And with that, NFS setup is done.\nSoftware Versions I’ve found it frustrating when I go find a technical post and can’t tell what versions of software they were using, so here are the versions of the software I used while writing this post.\nSoftware Version helm 4.0.1 kubectl 1.34 talosctl 1.11.5 talos 1.11.5 proxmox 9.0.3 Synology DSM 7.2.2 ",
  "wordCount" : "1271",
  "inLanguage": "en",
  "image": "https://unixorn.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished": "2025-12-12T23:49:23-07:00",
  "dateModified": "2025-12-12T23:49:23-07:00",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://unixorn.github.io/post/homelab/talos-nfs-provisioner/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "unixorn.github.io",
    "logo": {
      "@type": "ImageObject",
      "url": "https://unixorn.github.io/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://unixorn.github.io/" accesskey="h" title="Home (Alt + H)">
                <img src="https://unixorn.github.io/apple-touch-icon.png" alt="" aria-label="logo"
                    height="35">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://unixorn.github.io/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="https://unixorn.github.io/search/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
            <li>
                <a href="https://unixorn.github.io/about/" title="about">
                    <span>about</span>
                </a>
            </li>
            <li>
                <a href="https://unixorn.github.io/projects/" title="projects">
                    <span>projects</span>
                </a>
            </li>
            <li>
                <a href="https://unixorn.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://hachyderm.io/@unixorn" title="hachyderm.io/@unixorn">
                    <span>hachyderm.io/@unixorn</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">
<link rel="stylesheet" type="text/css" href="https://unixorn.github.io/css/mastodon.css" />
<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://unixorn.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://unixorn.github.io/post/">Posts</a></div>
    <h1 class="post-title">
      Using a NFS Provisioner with Talos
    </h1>
    <div class="post-meta"><span title='2025-12-12 23:49:23 -0700 MST'>December 12, 2025</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1271 words&nbsp;·&nbsp;Me

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#pre-requisites">Pre-requisites</a></li>
    <li><a href="#set-up-a-nfs-share">Set up a NFS share</a>
      <ul>
        <li><a href="#install-nfs-subdir-external-provisioner">Install nfs-subdir-external-provisioner</a></li>
        <li><a href="#test-nfs-on-talos">Test NFS on talos</a></li>
      </ul>
    </li>
    <li><a href="#software-versions">Software Versions</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>I&rsquo;ve been experimenting with running <a href="https://www.talos.dev/">Talos</a> in my home lab. I really like the idea of an immutable OS layer under Kubernetes and wanted to stand up a cluster to run some of my services that are currently run in docker-compose. I decided to use my Synology to store k8s volumes, here&rsquo;s how I set that up</p>
<p>I have a <a href="https://www.talos.dev/">Talos</a> cluster running in my proxmox cluster. Because it&rsquo;s immutable and is managed via API calls with <code>talosctl</code>, using the Synology isn&rsquo;t as simple as sshing to a kubernetes node and mounting a filesystem.</p>
<h2 id="pre-requisites">Pre-requisites<a hidden class="anchor" aria-hidden="true" href="#pre-requisites">#</a></h2>
<ul>
<li><code>helm</code> &amp; <code>talosctl</code>. I installed them on my M3Book with <code>brew</code>, but you can get other install instructions at <a href="https://helm.sh">helm.sh</a> and the Sidero Labs <a href="https://docs.siderolabs.com/omni/getting-started/how-to-install-talosctl#install-talosctl">website</a></li>
<li>An NFS server. I&rsquo;m using my Synology for this post and including setup instructions for it. There are are many tutorials out there for setting up NFS on Linux so that&rsquo;s out of scope for this post.</li>
<li>A working Talos cluster. I used a single-node one to validate these instructions.</li>
</ul>
<p>The NFS server on my Synology grants access based on the IP of the client machine. I recommend that you either configure your DHCP server to always assign your talos cluster nodes the same IP or assign a static address in your Talos cluster configuration. I prefer to do it on my DHCP server so there&rsquo;s a single source of truth for IP address assignments in my homelab.</p>
<h2 id="set-up-a-nfs-share">Set up a NFS share<a hidden class="anchor" aria-hidden="true" href="#set-up-a-nfs-share">#</a></h2>
<p>On my Synology, I went to <code>Control Panel</code> -&gt; <code>Shared Folder</code> and created a new shared folder <code>talos-nfs</code>, and enabled NFS on it. Keep track of the complete path to the folder (in my case <code>/volume2/talos-nfs</code>), you&rsquo;re going to need it later.</p>
<p>I also created a second share, <code>talos-nfs-retains</code> that I&rsquo;m going to use for a separate <code>storageClass</code> with a <code>reclaimPolicy</code> of <code>Retains</code>.  This one&rsquo;s path is <code>/volume2/talos-nfs-retains</code>.</p>
<p>Go to the <code>NFS Permissions</code> tab and create an access rule that allows connections from your talos node&rsquo;s IP address.</p>
<p>It&rsquo;ll look something like this:
<img alt="create-an-nfs-rule-dialog" loading="lazy" src="https://unixorn.github.io/images/homelab/talos-nfs/create-an-nfs-rule.png">
Put in the IP address of your talos node. I checked all three of the optional boxes - <code>Enable asynchronous</code>, <code>Allow connections from unprivileged ports</code> and <code>Allow users to access mounted subfolders</code>.</p>
<p>You <em>could</em> put in the entire <code>/24</code> (<code>10.1.2.0/24</code> in my example) but I don&rsquo;t recommend it for security reasons. Yes, it&rsquo;s a homelab and you should trust the other machines on your network, but assigning wide-open access to things &ldquo;just to get it running&rdquo; is a really bad habit to get into. Do it right, not right now.</p>
<h3 id="install-nfs-subdir-external-provisioner">Install nfs-subdir-external-provisioner<a hidden class="anchor" aria-hidden="true" href="#install-nfs-subdir-external-provisioner">#</a></h3>
<p>We&rsquo;re going to use <code>helm</code> to install the <code>nfs-subdir-external-provisioner</code>. I prefer using NFS because then any files the pods write are regular files in a directory tree on the server. This lets me use <code>restic</code> to back them up like I do with my other shares, and I can also move files in or out of the NFS volume without having to crack open an iSCSI volume.</p>
<p>Depending on your workload it can be a little slower than iSCSI, but my homelab services only have to support two users. Ease of backup is more of a priority for me than performance is.</p>
<h4 id="add-the-helm-repository">Add the helm repository<a hidden class="anchor" aria-hidden="true" href="#add-the-helm-repository">#</a></h4>
<p>We&rsquo;re going to use <code>helm</code> to install the provisioner, so to get started, install the helm repository and do a <code>helm repo update</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="o">&amp;&amp;</span> helm repo update
</span></span></code></pre></div><h4 id="install-the-provisioners">Install the provisioners<a hidden class="anchor" aria-hidden="true" href="#install-the-provisioners">#</a></h4>
<p>My Synology has two bonded ports on 10.0.1.108. <code>nfs.path</code> should be the path being exported from the nfs server, you don&rsquo;t have to care where talos mounts it.</p>
<p>The default is storage class name is <code>nfs-client</code>). I&rsquo;m using <code> --set storageClass.name=different-nfs-client-name</code> in the <code>helm</code> command below to specify names that would be clear about the reclaim policy.</p>
<p>I don&rsquo;t want to accidentally create any volume claims locally if I forget to specify a <code>storageClass</code>, so I made this the default <code>storageClass</code>. Remove the <code>--set storageClass.defaultClass=true</code> argument if you want something else for your default.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NFS_SERVER_IP</span><span class="o">=</span>YOUR_SERVERS_IP
</span></span><span class="line"><span class="cl">helm install nfs-provisioner-deletes <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  nfs-subdir-external-provisioner/nfs-subdir-external-provisioner <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set nfs.server<span class="o">=</span><span class="nv">$NFS_SERVER_IP</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set nfs.path<span class="o">=</span>/volume2/talos-nfs <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set storageClass.reclaimPolicy<span class="o">=</span>Delete <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set storageClass.defaultClass<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set storageClass.archiveOnDelete<span class="o">=</span><span class="nb">false</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set storageClass.name<span class="o">=</span>nfs-client-deletes <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set storageClass.onDelete<span class="o">=</span>delete
</span></span></code></pre></div><p>I also added a second <code>storageClass</code>, this time with the <code>reclaimPolicy</code> set to <code>Retains</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">helm install nfs-provisioner-retains <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  nfs-subdir-external-provisioner/nfs-subdir-external-provisioner <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set nfs.server<span class="o">=</span><span class="nv">$NFS_SERVER_IP</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set nfs.path<span class="o">=</span>/volume2/talos-nfs-retains <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set storageClass.name<span class="o">=</span>nfs-client-retains <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set storageClass.reclaimPolicy<span class="o">=</span>Retain
</span></span></code></pre></div><h4 id="confirm-that-the-install-succeeded">Confirm that the install succeeded.<a hidden class="anchor" aria-hidden="true" href="#confirm-that-the-install-succeeded">#</a></h4>
<p>Check your pods and storage classes with <code>kubectl</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pod
</span></span><span class="line"><span class="cl">NAME                                                              READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nfs-provisioner-retains-nfs-subdir-external-provisioner-bc7f6tp   1/1     Running   <span class="m">0</span>          11m
</span></span><span class="line"><span class="cl">nfs-subdir-external-provisioner-745688c67-c27mg                   1/1     Running   <span class="m">0</span>          21m
</span></span><span class="line"><span class="cl">$ kubectl get sc
</span></span><span class="line"><span class="cl">NAME                           PROVISIONER                                                             RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
</span></span><span class="line"><span class="cl">nfs-client-deletes <span class="o">(</span>default<span class="o">)</span>   cluster.local/nfs-subdir-external-provisioner                           Delete          Immediate           <span class="nb">true</span>                   22m
</span></span><span class="line"><span class="cl">nfs-client-retains             cluster.local/nfs-provisioner-retains-nfs-subdir-external-provisioner   Retain          Immediate           <span class="nb">true</span>                   12m
</span></span></code></pre></div><p>It only took a few seconds for the provisioner pod to come ready. If the provisioner pod never comes ready, check that you have the right IP address in your NFS permissions - when I first set this up I put a <code>.15</code> where it should have had a <code>.51</code>.</p>
<p>Once the <code>nfs-subdir-external-provisioner</code> pod is ready, we can start testing it.</p>
<h3 id="test-nfs-on-talos">Test NFS on talos<a hidden class="anchor" aria-hidden="true" href="#test-nfs-on-talos">#</a></h3>
<h4 id="create-a-dynamic-pvc">Create a dynamic PVC<a hidden class="anchor" aria-hidden="true" href="#create-a-dynamic-pvc">#</a></h4>
<p>Create the a yaml file describing the test pvc, <code>debian-tester-pvc-deletes.yaml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># debian-tester-pvc-deletes.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolumeClaim</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">debian-test-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-deletes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">5Gi</span><span class="w">
</span></span></span></code></pre></div><p>Create the pvc with <code>kubectl</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl apply -f debian-tester-pvc-deletes.yaml
</span></span></code></pre></div><h4 id="create-a-debian-deployment-that-uses-the-new-pvc">Create a debian deployment that uses the new PVC<a hidden class="anchor" aria-hidden="true" href="#create-a-debian-deployment-that-uses-the-new-pvc">#</a></h4>
<p>Create a yaml file for a debian test deployment that attaches the test pvc, <code>debian-pvc-test-deployment.yaml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Toy debian deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">debian-tester-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">debian-tester</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">debian-tester</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">debian-tester-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># Use a standard Debian image</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">debian:stable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/bin/bash&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;-c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;echo &#39;Data created in PVC&#39; &gt; /mnt/data/testfile.txt; while true; do sleep 30; done;&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># Mount the volume named &#39;persistent-storage&#39; to the container path &#39;/mnt/data&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">persistent-storage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/mnt/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">persistent-storage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">debian-test-pvc</span><span class="w">
</span></span></span></code></pre></div><p>And deploy it with</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl apply -f debian-pvc-test-deployment.yaml
</span></span></code></pre></div><h4 id="confirm-our-deployment-succeeded">Confirm our deployment succeeded<a hidden class="anchor" aria-hidden="true" href="#confirm-our-deployment-succeeded">#</a></h4>
<p>We should now be able to see our deployment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get deployment
</span></span><span class="line"><span class="cl">NAME                                                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">debian-tester-deployment                                  1/1     <span class="m">1</span>            <span class="m">1</span>           25s
</span></span></code></pre></div><p>A running pod for it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl get pod
</span></span><span class="line"><span class="cl">NAME                                                              READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">debian-tester-deployment-77ddd68557-qvcrk                         1/1     Running   <span class="m">0</span>          2m24s
</span></span></code></pre></div><p>And finally get a shell in the running pod:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Use the pod name from kubectl get pod, in this case</span>
</span></span><span class="line"><span class="cl"><span class="nv">DEBIAN_P</span><span class="o">=</span>debian-tester-deployment-77ddd68557-qvcrk
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> <span class="nv">$DEBIAN_P</span> -it -- bash
</span></span><span class="line"><span class="cl">root@debian-tester-deployment-77ddd68557-qvcrk:/#
</span></span></code></pre></div><p>Inside the pod, we can now <code>cd /mnt/data</code> and create some files as a test</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> /mnt/data
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Success&#34;</span> &gt; pvc-test
</span></span><span class="line"><span class="cl">root@debian-tester-deployment-77ddd68557-qvcrk:/mnt/data# ls
</span></span><span class="line"><span class="cl">pvc-test  testfile.txt
</span></span></code></pre></div><h4 id="confirm-it-on-the-nfs-server-side">Confirm it on the NFS server side<a hidden class="anchor" aria-hidden="true" href="#confirm-it-on-the-nfs-server-side">#</a></h4>
<p><code>ssh</code> into your NFS server and <code>cd</code> into the directory you shared. In my case, <code>/volume2/talos-nfs</code> and we can see a directory for the pvc.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> /volume2/talos-nfs
</span></span><span class="line"><span class="cl">ls
</span></span><span class="line"><span class="cl"><span class="c1">#recycle</span>
</span></span><span class="line"><span class="cl">@eaDir
</span></span><span class="line"><span class="cl">default-debian-test-pvc-pvc-e6cf5df1-90c8-4962-97bb-91ae795945bc
</span></span><span class="line"><span class="cl">/volume2/talos-nfs $ cat default-debian-test-pvc-pvc-e6cf5df1-90c8-4962-97bb-91ae795945bc/pvc-test
</span></span><span class="line"><span class="cl">Success
</span></span><span class="line"><span class="cl">/volume2/talos-nfs $
</span></span></code></pre></div><h4 id="persistence-test">Persistence test<a hidden class="anchor" aria-hidden="true" href="#persistence-test">#</a></h4>
<p>Delete the deployment.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl delete deployment debian-tester-deployment
</span></span></code></pre></div><p>Create the deployment again.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl apply -f debian-pvc-test-deployment.yaml
</span></span></code></pre></div><p>Find the new pod with <code>kubectl get pod</code>, and get a shell in it. You&rsquo;ll see the files you created in <code>/mnt/data</code></p>
<h4 id="clean-up">Clean up<a hidden class="anchor" aria-hidden="true" href="#clean-up">#</a></h4>
<p>Delete the deployment</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl delete deployment debian-tester-deployment
</span></span></code></pre></div><p>Delete the pvc</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl delete pvc debian-test-pvc
</span></span></code></pre></div><p>The subdirectory on your NFS server should be gone - ssh in and confirm</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> /volume2/talos-nfs
</span></span><span class="line"><span class="cl">ls
</span></span><span class="line"><span class="cl"><span class="c1">#recycle</span>
</span></span><span class="line"><span class="cl">@eaDir
</span></span><span class="line"><span class="cl">/volume2/talos-nfs $
</span></span></code></pre></div><p>And with that, NFS setup is done.</p>
<h2 id="software-versions">Software Versions<a hidden class="anchor" aria-hidden="true" href="#software-versions">#</a></h2>
<p>I&rsquo;ve found it frustrating when I go find a technical post and can&rsquo;t tell what versions of software they were using, so here are the versions of the software I used while writing this post.</p>
<table>
  <thead>
      <tr>
          <th>Software</th>
          <th>Version</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>helm</code></td>
          <td>4.0.1</td>
      </tr>
      <tr>
          <td><code>kubectl</code></td>
          <td>1.34</td>
      </tr>
      <tr>
          <td><code>talosctl</code></td>
          <td>1.11.5</td>
      </tr>
      <tr>
          <td><code>talos</code></td>
          <td>1.11.5</td>
      </tr>
      <tr>
          <td><code>proxmox</code></td>
          <td>9.0.3</td>
      </tr>
      <tr>
          <td>Synology DSM</td>
          <td>7.2.2</td>
      </tr>
  </tbody>
</table>

  </div>
  <div>
    
<div class="article-content">
  <h2>Comments</h2>
  <p>You can use your Mastodon account to reply to this<a class="button" href="https://hachyderm.io/@unixorn/115713609740480294">post</a></p>
  <p><button class="button" id="replyButton" href="https://hachyderm.io/@unixorn/115713609740480294">Reply</button></p>
  <dialog id="toot-reply" class="mastodon" data-component="dialog">
    <h3>Reply to unixorn's post</h3>
    <p>
      With an account on the Fediverse or Mastodon, you can respond to this post.
      Since Mastodon is decentralized, you can use your existing account hosted by another Mastodon server or compatible platform if you don't have an account on this one.
    </p>
    <p>Copy and paste this URL into the search field of your favourite Fediverse app or the web interface of your Mastodon server.</p>
    <div class="copypaste">
      <input type="text" readonly="" value="https://hachyderm.io/@unixorn/115713609740480294">
      <button class="button" id="copyButton">Copy</button>
      <button class="button" id="cancelButton">Close</button>
    </div>
  </dialog>
  <p id="mastodon-comments-list"><button id="load-comment" class="button">Load comments</button></p>
  <noscript><p>You need JavaScript to view the comments.</p></noscript>
  <script src="https://unixorn.github.io/assets/js/purify.min.js"></script>
  <script type="text/javascript">
    const dialog = document.querySelector('dialog');

    document.getElementById('replyButton').addEventListener('click', () => {
      dialog.showModal();
    });

    document.getElementById('copyButton').addEventListener('click', () => {
      navigator.clipboard.writeText('https://hachyderm.io/@unixorn/115713609740480294');
    });

    document.getElementById('cancelButton').addEventListener('click', () => {
      dialog.close();
    });

    dialog.addEventListener('keydown', e => {
      if (e.key === 'Escape') dialog.close();
    });

    const dateOptions = {
      year: "numeric",
      month: "numeric",
      day: "numeric",
      hour: "numeric",
      minute: "numeric",
    };

    function escapeHtml(unsafe) {
      return unsafe
           .replace(/&/g, "&amp;")
           .replace(/</g, "&lt;")
           .replace(/>/g, "&gt;")
           .replace(/"/g, "&quot;")
           .replace(/'/g, "&#039;");
   }

    document.getElementById("load-comment").addEventListener("click", function() {
      document.getElementById("load-comment").innerHTML = "Loading";
      fetch('https://hachyderm.io/api/v1/statuses/115713609740480294/context')
        .then(function(response) {
          return response.json();
        })
        .then(function(data) {
          if(data['descendants'] &&
             Array.isArray(data['descendants']) &&
            data['descendants'].length > 0) {
              document.getElementById('mastodon-comments-list').innerHTML = "";
              data['descendants'].forEach(function(reply) {
                reply.account.display_name = escapeHtml(reply.account.display_name);
                reply.account.reply_class = reply.in_reply_to_id == "115713609740480294" ? "reply-original" : "reply-child";
                reply.account.emojis.forEach(emoji => {
                  reply.account.display_name = reply.account.display_name.replace(`:${emoji.shortcode}:`,
                    `<img src="${escapeHtml(emoji.static_url)}" alt="Emoji ${emoji.shortcode}" height="20" width="20" />`);
                });
                mastodonComment =
                  `<div class="mastodon-wrapper">
                    <div class="comment-level ${reply.account.reply_class}"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" fill="none" transform="rotate(180)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path stroke="#535358" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.608 12.526l7.04-6.454C13.931 4.896 16 5.806 16 7.546V11c13 0 11 16 11 16s-4-10-11-10v3.453c0 1.74-2.069 2.65-3.351 1.475l-7.04-6.454a2 2 0 010-2.948z"></path> </g></svg></div>
                    <div class="mastodon-comment">
                     <div class="avatar">
                       <img src="${escapeHtml(reply.account.avatar_static)}" height=60 width=60 alt="">
                     </div>
                     <div class="content">
                       <div class="author">
                         <a href="${reply.account.url}" rel="nofollow">
                           <span>${reply.account.display_name}</span>
                           <span class="disabled">${escapeHtml(reply.account.acct)}</span>
                         </a>
                         <a class="date" href="${reply.uri}" rel="nofollow">
                           ${reply.created_at.substr(0, 10)}
                         </a>
                       </div>
                       <div class="mastodon-comment-content">${reply.content}</div>
                     </div>
                   </div>
                  </div>`;
                document.getElementById('mastodon-comments-list').appendChild(DOMPurify.sanitize(mastodonComment, {'RETURN_DOM_FRAGMENT': true}));
              });
          } else {
            document.getElementById('mastodon-comments-list').innerHTML = "<p>No comments found</p>";
          }
        });
      });
  </script>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://unixorn.github.io/tags/homelab/">Homelab</a></li>
      <li><a href="https://unixorn.github.io/tags/k8s/">K8s</a></li>
      <li><a href="https://unixorn.github.io/tags/kubernetes/">Kubernetes</a></li>
      <li><a href="https://unixorn.github.io/tags/talos/">Talos</a></li>
      <li><a href="https://unixorn.github.io/tags/nfs/">Nfs</a></li>
      <li><a href="https://unixorn.github.io/tags/synology/">Synology</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://unixorn.github.io/post/2025-12-26-advice-for-switching-to-proton-hosted-email/">
    <span class="title">« Prev</span>
    <br>
    <span>Switching to Proton.me eMail Advice</span>
  </a>
  <a class="next" href="https://unixorn.github.io/post/homelab/weird-shit-is-afoot-with-macos-and-iterm/">
    <span class="title">Next »</span>
    <br>
    <span>Weird shit is afoot with macOS and iTerm</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Using a NFS Provisioner with Talos on x"
            href="https://x.com/intent/tweet/?text=Using%20a%20NFS%20Provisioner%20with%20Talos&amp;url=https%3a%2f%2funixorn.github.io%2fpost%2fhomelab%2ftalos-nfs-provisioner%2f&amp;hashtags=homelab%2ck8s%2ckubernetes%2ctalos%2cnfs%2csynology">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Using a NFS Provisioner with Talos on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2funixorn.github.io%2fpost%2fhomelab%2ftalos-nfs-provisioner%2f&amp;title=Using%20a%20NFS%20Provisioner%20with%20Talos&amp;summary=Using%20a%20NFS%20Provisioner%20with%20Talos&amp;source=https%3a%2f%2funixorn.github.io%2fpost%2fhomelab%2ftalos-nfs-provisioner%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Using a NFS Provisioner with Talos on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2funixorn.github.io%2fpost%2fhomelab%2ftalos-nfs-provisioner%2f&title=Using%20a%20NFS%20Provisioner%20with%20Talos">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Using a NFS Provisioner with Talos on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2funixorn.github.io%2fpost%2fhomelab%2ftalos-nfs-provisioner%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Using a NFS Provisioner with Talos on whatsapp"
            href="https://api.whatsapp.com/send?text=Using%20a%20NFS%20Provisioner%20with%20Talos%20-%20https%3a%2f%2funixorn.github.io%2fpost%2fhomelab%2ftalos-nfs-provisioner%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Using a NFS Provisioner with Talos on telegram"
            href="https://telegram.me/share/url?text=Using%20a%20NFS%20Provisioner%20with%20Talos&amp;url=https%3a%2f%2funixorn.github.io%2fpost%2fhomelab%2ftalos-nfs-provisioner%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Using a NFS Provisioner with Talos on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Using%20a%20NFS%20Provisioner%20with%20Talos&u=https%3a%2f%2funixorn.github.io%2fpost%2fhomelab%2ftalos-nfs-provisioner%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>Copyright 2019-2024, Joe Block. All rights reserved.</span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
        <a rel="me" href="https://hachyderm.io/@unixorn">Mastodon</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
