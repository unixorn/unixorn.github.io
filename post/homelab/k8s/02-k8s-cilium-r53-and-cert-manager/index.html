<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 | unixorn.github.io</title>
<meta name="keywords" content="cert-manager, homelab, k8s, letsencrypt, r53, ssl, talos">
<meta name="description" content="In part two of this homelab kubernetes setup series, we&rsquo;re going to install &amp; configure cert-manager to use LetsEncrypt with Route 53 so we can use SSL to connect to our services.
The tutorials I&rsquo;ve seen for using cert-manager with a DNS challenge all use CloudFlare. I have my lab domain on Route 53 so this post will cover that instead.
Talos Homelab Setup Series

01 - Setting up Talos with a Cilium CNI on proxmox
02 - Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53

Pre-requisites

A domain hosted on Amazon Route 53 that you have administrative rights on.
A working kubernetes cluster with Cilium installed and configured to be a Gateway. I&rsquo;m using Talos for mine, but regular kubernetes or k3s clusters will work too. If you need to set up a new cluster, or configure an existing one to use Cilum, read part one of this series.
cilium, kubectl &amp; helm - if you don&rsquo;t want to brew install them, install instructions are at cilium.io, helm.sh and kubectl.

Software Versions
Here are the versions of the software I used while writing this post. Later versions should work, but this is what these instructions were tested with.">
<meta name="author" content="Me">
<link rel="canonical" href="http://localhost:1313/post/homelab/k8s/02-k8s-cilium-r53-and-cert-manager/">
<meta name="google-site-verification" content="UA-100853138-2">
<link crossorigin="anonymous" href="http://localhost:1313/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css" integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF&#43;13Dyqob6ASlTrTye8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/post/homelab/k8s/02-k8s-cilium-r53-and-cert-manager/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/post/homelab/k8s/02-k8s-cilium-r53-and-cert-manager/">
  <meta property="og:site_name" content="unixorn.github.io">
  <meta property="og:title" content="Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53">
  <meta property="og:description" content="In part two of this homelab kubernetes setup series, we’re going to install &amp; configure cert-manager to use LetsEncrypt with Route 53 so we can use SSL to connect to our services.
The tutorials I’ve seen for using cert-manager with a DNS challenge all use CloudFlare. I have my lab domain on Route 53 so this post will cover that instead.
Talos Homelab Setup Series 01 - Setting up Talos with a Cilium CNI on proxmox 02 - Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 Pre-requisites A domain hosted on Amazon Route 53 that you have administrative rights on. A working kubernetes cluster with Cilium installed and configured to be a Gateway. I’m using Talos for mine, but regular kubernetes or k3s clusters will work too. If you need to set up a new cluster, or configure an existing one to use Cilum, read part one of this series. cilium, kubectl &amp; helm - if you don’t want to brew install them, install instructions are at cilium.io, helm.sh and kubectl. Software Versions Here are the versions of the software I used while writing this post. Later versions should work, but this is what these instructions were tested with.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2026-01-04T15:17:37-07:00">
    <meta property="article:modified_time" content="2026-01-04T15:17:37-07:00">
    <meta property="article:tag" content="Cert-Manager">
    <meta property="article:tag" content="Homelab">
    <meta property="article:tag" content="K8s">
    <meta property="article:tag" content="Letsencrypt">
    <meta property="article:tag" content="R53">
    <meta property="article:tag" content="Ssl">
      <meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name="twitter:title" content="Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53">
<meta name="twitter:description" content="In part two of this homelab kubernetes setup series, we&rsquo;re going to install &amp; configure cert-manager to use LetsEncrypt with Route 53 so we can use SSL to connect to our services.
The tutorials I&rsquo;ve seen for using cert-manager with a DNS challenge all use CloudFlare. I have my lab domain on Route 53 so this post will cover that instead.
Talos Homelab Setup Series

01 - Setting up Talos with a Cilium CNI on proxmox
02 - Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53

Pre-requisites

A domain hosted on Amazon Route 53 that you have administrative rights on.
A working kubernetes cluster with Cilium installed and configured to be a Gateway. I&rsquo;m using Talos for mine, but regular kubernetes or k3s clusters will work too. If you need to set up a new cluster, or configure an existing one to use Cilum, read part one of this series.
cilium, kubectl &amp; helm - if you don&rsquo;t want to brew install them, install instructions are at cilium.io, helm.sh and kubectl.

Software Versions
Here are the versions of the software I used while writing this post. Later versions should work, but this is what these instructions were tested with.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53",
      "item": "http://localhost:1313/post/homelab/k8s/02-k8s-cilium-r53-and-cert-manager/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53",
  "name": "Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53",
  "description": "In part two of this homelab kubernetes setup series, we\u0026rsquo;re going to install \u0026amp; configure cert-manager to use LetsEncrypt with Route 53 so we can use SSL to connect to our services.\nThe tutorials I\u0026rsquo;ve seen for using cert-manager with a DNS challenge all use CloudFlare. I have my lab domain on Route 53 so this post will cover that instead.\nTalos Homelab Setup Series 01 - Setting up Talos with a Cilium CNI on proxmox 02 - Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 Pre-requisites A domain hosted on Amazon Route 53 that you have administrative rights on. A working kubernetes cluster with Cilium installed and configured to be a Gateway. I\u0026rsquo;m using Talos for mine, but regular kubernetes or k3s clusters will work too. If you need to set up a new cluster, or configure an existing one to use Cilum, read part one of this series. cilium, kubectl \u0026amp; helm - if you don\u0026rsquo;t want to brew install them, install instructions are at cilium.io, helm.sh and kubectl. Software Versions Here are the versions of the software I used while writing this post. Later versions should work, but this is what these instructions were tested with.\n",
  "keywords": [
    "cert-manager", "homelab", "k8s", "letsencrypt", "r53", "ssl", "talos"
  ],
  "articleBody": "In part two of this homelab kubernetes setup series, we’re going to install \u0026 configure cert-manager to use LetsEncrypt with Route 53 so we can use SSL to connect to our services.\nThe tutorials I’ve seen for using cert-manager with a DNS challenge all use CloudFlare. I have my lab domain on Route 53 so this post will cover that instead.\nTalos Homelab Setup Series 01 - Setting up Talos with a Cilium CNI on proxmox 02 - Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 Pre-requisites A domain hosted on Amazon Route 53 that you have administrative rights on. A working kubernetes cluster with Cilium installed and configured to be a Gateway. I’m using Talos for mine, but regular kubernetes or k3s clusters will work too. If you need to set up a new cluster, or configure an existing one to use Cilum, read part one of this series. cilium, kubectl \u0026 helm - if you don’t want to brew install them, install instructions are at cilium.io, helm.sh and kubectl. Software Versions Here are the versions of the software I used while writing this post. Later versions should work, but this is what these instructions were tested with.\nSoftware Version cert-manager 1.19.2 helm 4.0.1 kubectl 1.34 kubernetes 1.34.1 talos 1.11.5 Instructions I don’t have any services exposed to the internet, and I’m not interested in exposing a web server just to answer HTTP queries by LetsEncrypt.\nHere’s how to configure cert-manager to use a DNS01 challenge with LetsSencrypt instead of an HTTP one. This will let LetsEncrypt validate ownership of your domain by checking for DNS records created/updated by cert-manager during certificate creation and renewal. As a bonus, using DNS challenges also lets you create wildcard certificates for your domain.\nCreate an AWS user for cert-manager To validate certificate requests via DNS, cert-manager is going to need to use AWS credentials that have privilege to update DNS domains. Do not use your root IAM account! You should only ever use your root IAM account to create users that have the minimum privilege they need for explicit tasks. So instead, we’re going to create a user with access limited to updating domains hosted on Route 53.\nCreate an IAM policy First create a policy that grants control over Route53. Log in to the AWS console and select Identity and Access Management (IAM), then select Policies from the sidebar, and finally, hit the Create Policy button.\nCreating the policy first makes it easier to attach to an IAM group when we create one in the next step.\nI’ve already created a working policy, so instead of manually adding permissions, click JSON to the right of where it says Policy Editor and paste in this JSON snippet\n{ \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\", \"route53:GetHostedZone\" ], \"Resource\": [ \"arn:aws:route53:::hostedzone/YOUR_DOMAINS_ZONE_ID\" ] } ] } As of 2026-01-03, it should look like this:\nClick Next, and give your new policy a name and a description, for example blog-letsencrypt.\nCreate an IAM group You could attach a policy to a user, but using a group makes it easier to create other users with this set of permissions. I have a different IAM user that I use for nginx-proxy-manager on my standalone hosts, and I also use different users for my dev and prod clusters.\nNow create a group, click User Groups in the side bar, then hit the Create Group button. Give it a name like blog-le-users.\nUnder Attach permissions policy* select the blog-letsencrypt policy you just created.\nHit the Create Group button on the bottom right of the page.\nCreate an IAM user Now that the group and policy are created, you can finally create your R53 IAM user. Click Users in the side bar, then click the Add Users button on the right side of the screen.\nGive it a name like r53-acme-user and click Next.\nDon’t check the Provide user access to the AWS Management Console checkbox, this user will only be used by cert-manager. Select the blog-le-users group\nClick Next again.\nYou’ll see a review and create page:\nClick Create user on the bottom right of the page.\nOne last thing - you’ll need to create access credentials for the user. Click on Users in the side bar again, then your brand new r53-acme-user user.\nYou’ll see an info page about the user, click the Security Credentials tab\nScroll down to Access Keys, and click Create access key.\nClick Other on the next page\nClick Next. Put in letsencrypt for the description,and click Create access key again.\nYou’ll see something like\nYou only get one chance to see the secret key, so store it in your password manager. It isn’t a huge deal if you lose it, you can always create another access key for your user. Copy the access key \u0026 secret keys into your password manager for later use.\nInstall cert-manager We’re going to use helm to install cert-manager, so first we need to add its helm repository.\nAdd the Jetstack repo helm repo add jetstack https://charts.jetstack.io \u0026\u0026 helm repo update Get the helm repository gpg keyring The cert-manager team provides a gpg keyring to validate the helm chart when we install it.\ncurl -LO https://cert-manager.io/public-keys/cert-manager-keyring-2021-09-20-1020CF3C033D4F35BAE1C19E1226061C665DF13E.gpg Install cert‑manager and the CRDs it needs Now that we have AWS credentials set up, let’s use helm to create a cert-manager namespace, verify the chart using the gpg keyring and install cert-manager along with the CRDs it needs.\nhelm install \\ cert-manager oci://quay.io/jetstack/charts/cert-manager \\ --version v1.19.2 \\ --namespace cert-manager \\ --create-namespace \\ --keyring ./cert-manager-keyring-2021-09-20-1020CF3C033D4F35BAE1C19E1226061C665DF13E.gpg \\ --verify \\ --set crds.enabled=true Confirm installation with helm list helm list --all-namespaces You should see something like\nNAME NAMESPACE REVISION\tUPDATED STATUS CHART APP VERSION cert-manager\tcert-manager\t1 2026-01-03 22:42:45.78814 -0700 MST deployed\tcert-manager-v1.19.2\tv1.19.2 Configure cert-manager Create an AWS credential secret Setting up an external secret provider is out of scope for this post. We’re going to store the AWS credentials in a secret.\nFor tidiness, we’re going to put all the cert-manager confguration yaml files in a cert-manager directory, so mkdir cert-manager.\nCreate a cert-manager/aws-secret.yaml file.\napiVersion: v1 kind: Secret metadata: name: route53-aws-secret namespace: cert-manager type: Opaque stringData: # Replace these with your actual keys (or use a Kubernetes external secret provider) access-key-id: YOUR_R53_IAM_USER_AWS_ACCESS_KEY_ID secret-access-key: YOUR_R53_IAM_USER_AWS_SECRET_ACCESS_KEY Create a ClusterIssuer Create cert-manager/cluster-issuer.yaml. Make sure you set the email field to your real email so LetsEncrypt can notify you about policy changes or issues.\napiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-dns-r53 spec: acme: # Use the production server for real certificates; switch to the staging URL while testing. server: https://acme-v02.api.letsencrypt.org/directory # staging: https://acme-staging-v02.api.letsencrypt.org/directory email: your@email.example # \u003c-- change to your real contact address privateKeySecretRef: name: letsencrypt-dns-r53-account-key solvers: - dns01: route53: region: us-east-1 # Region where your hosted zone lives hostedZoneID: \"\" # Articles I read said this was optional, but when I left it empty cert‑manager didn't discover it and my certs never came ready accessKeyIDSecretRef: name: route53-aws-secret key: access-key-id secretAccessKeySecretRef: name: route53-aws-secret key: secret-access-key Apply the configuration kubectl apply -f cert-manager # Apply all the yaml files in the directory Confirm that the ClusterIssuer is working Create a standlone certificate with the ClusterIssuer so that we can confirm that LetsEncrypt is working before we try to use it with an Ingress.\n# standalone-certificate.yaml apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: wildcard-yourdomain-com namespace: default spec: secretName: yourdomain-com-tls dnsNames: - 'yourdomain.com' - '*.yourdomain.com' # This is a homelab, so I'm ok with using a wildcard certificate for all my services issuerRef: name: letsencrypt-dns-r53 kind: ClusterIssuer Make sure the secretName is unique to this certificate or you’ll get mysterious breakages, then apply it.\nkubectl apply -f standalone-certificate.yaml Wait a few seconds, then run\nkubectl get certificate --all-namespaces You should see something like\nNAMESPACE NAME READY SECRET AGE default wildcard-yourdomain-com-cert True yourdomain-com--tls. 1m The first time I made a certificate it took almost a minute, so don’t assume things are broken if the certificate doesn’t show as ready right away.\nBehind the scenes, cert-manager is creating a certificate, creating the required DNS entries, posting an ACME request to LetsEncrypt, waiting for LetsEncrypt to verify the DNS records and sign your certificate, and then finally loading the signed certfificate. It can take a literal minute if LetsEncrypt is busy.\nIf you run kubectl describe certificate wildcard-your-domain-com you should see something like this:\nName: wildcard-your-domain-cert Namespace: default Labels: Annotations: API Version: cert-manager.io/v1 Kind: Certificate Metadata: Creation Timestamp: 2026-01-03T07:18:54Z Generation: 1 Resource Version: 225621 UID: 12345678-90AB-CDEFGHIJK-LMNOPQRSTUVW Spec: Dns Names: www.yourdomain.com Issuer Ref: Kind: ClusterIssuer Name: letsencrypt-dns-r53 Secret Name: your-domain-com-tls Status: Conditions: Last Transition Time: 2026-01-03T07:19:02Z Message: Certificate is up to date and has not expired Observed Generation: 1 Reason: Ready Status: True Type: Ready Not After: 2026-04-03T06:20:29Z Not Before: 2026-01-03T06:20:30Z Renewal Time: 2026-03-04T06:20:29Z Revision: 1 Events: Great, the cert exists and has ready status, now to test it.\nCreate a playground workload Create a playground directory, and create playground/01-playground-nginx.yaml\n# 01-playground-nginx.yaml # Create the playground namespace apiVersion: v1 kind: Namespace metadata: labels: kubernetes.io/metadata.name: playground name: playground --- # Create an nginx deployment. apiVersion: apps/v1 kind: Deployment metadata: name: playground-nginx-app namespace: playground spec: selector: matchLabels: app: playground-nginx-pod # \u003c-- must match pod labels exactly replicas: 1 template: metadata: labels: app: playground-nginx-pod spec: # Talos is very security oriented, so we have to set up the # security context explicitly # ---------- Pod‑level security settings ---------- securityContext: runAsNonRoot: true runAsUser: 101 # non‑root UID that the image can run as seccompProfile: type: RuntimeDefault # Uncomment if you need a shared FS group for volume writes # fsGroup: 101 # ---------- Containers ---------- containers: - name: nginx-playground-container image: nginxinc/nginx-unprivileged:latest # Alpine, but we force a non‑root UID imagePullPolicy: IfNotPresent ports: - containerPort: 8080 # talos requires us to specify our resources instead of # letting k8s YOLO them resources: requests: memory: \"64Mi\" cpu: \"250m\" limits: memory: \"128Mi\" cpu: \"500m\" securityContext: allowPrivilegeEscalation: false capabilities: drop: - ALL --- # And finally, create a service apiVersion: v1 kind: Service metadata: name: playground-nginx-service namespace: playground spec: selector: app: playground-nginx-pod ports: - name: http port: 80 # This is what the service is listening on, and what will be routed to targetPort: 8080 # Port the pods are listening on, don't route directly here! Configure Cilium Create a Gateway We’re going to create a gateway that listens to both HTTP and HTTPS traffic. Create playground/02-playground-gateway\nWe’re specifying a specific IP address from our pool so that it stays static and we can create a DNS entry for it\n# 02-playground-gateway apiVersion: gateway.networking.k8s.io/v1 kind: Gateway metadata: name: playground-gateway # Note - we are _not_ putting this in a namespace so our workloads can # share it. spec: gatewayClassName: cilium addresses: - type: IPAddress value: 10.0.1.160 # Force the gateway to grab a specific IP from the pool listeners: - name: http protocol: HTTP port: 80 allowedRoutes: namespaces: from: All - name: https protocol: HTTPS port: 443 allowedRoutes: namespaces: from: All tls: certificateRefs: - kind: Secret name: yourdomain-com-tls Create the gateway now so you can find out what IP address it gets.\nkubectl apply -f playground/02-playground-gateway.yaml \u0026\u0026 \\ kubectl get gateway --all-namespaces You’ll see something like\nNAMESPACE NAME CLASS ADDRESS PROGRAMMED AGE default playground-gateway cilium 10.0.1.160 True 1h For the rest of these instructions, we’re going to assume your gateway is 10.0.1.160.\nGo to Amazon’s R53 control panel and create an A record in your domain, ip-160.yourdomain.com with the address 10.0.1.160.\nCreate HTTPRoutes We’re going to create two HTTPRoutes, one for HTTP and one for HTTPS. Create playground/03-httproutes.yaml\n# 03-httproutes.yaml apiVersion: gateway.networking.k8s.io/v1 kind: HTTPRoute metadata: name: playground-http-route namespace: playground spec: parentRefs: - name: playground-gateway namespace: default sectionName: http hostnames: - \"ip-160.yourdomain.com\" rules: - backendRefs: - name: playground-nginx-service port: 80 --- apiVersion: gateway.networking.k8s.io/v1 kind: HTTPRoute metadata: name: playground-ssl-route namespace: playground spec: parentRefs: - name: playground-gateway namespace: default sectionName: https hostnames: - \"ip-160.yourdomain.com\" rules: - backendRefs: - name: playground-nginx-service port: 80 Apply and test Now we’re finally ready to create our routes\nkubectl apply -f playground \u0026\u0026 \\ kubectl get gateway \u0026\u0026 echo \u0026\u0026 \\ kubectl get httproute --all-namespaces You should see something like this:\nNAME CLASS ADDRESS PROGRAMMED AGE playground-gateway cilium 10.0.1.160 True 23h NAMESPACE NAME HOSTNAMES AGE playground playground-http-route [\"ip-160.yourdomain.com\"] 3m playground playground-ssl-route [\"ip-160.yourdomain.com\"] 3m You should now see the Welcome to nginx! page when you go to either http://ip-160.yourdomain.com or https://ip-160.yourdomain.com.\nBonus - create an http -\u003e https redirect If I go to the http url instead of https, I want to be automagically redirected to https so I don’t accidentally send any login credentials on an unencrypted connection.\nUpdate our HTTProutes Our gateway is already configured to listen on both http and https, so we’re going to create an HTTPRoute that listens on port 80 and redirects any hits to port 443.\nCreate playground/04-redirect-http-to-https.yaml\n# 04-redirect-http-to-https.yaml kind: HTTPRoute apiVersion: gateway.networking.k8s.io/v1beta1 metadata: name: http-to-https-redirect namespace: default spec: parentRefs: - namespace: default name: playground-gateway sectionName: http rules: - filters: - type: RequestRedirect requestRedirect: scheme: https Now let’s replace the old http route\nkubectl delete httproute playground-http-route -n playground \u0026\u0026 \\ kubectl apply -f playground/04-redirect-http-to-https.yaml \u0026\u0026 \\ curl -iv ip160.yourdomain.com You should see something like this - on line 14 you can see it get a 302 and on line 29 it opens a new connection to port 443.\n* Host ip-160.yourdomain.com:80 was resolved. * IPv6: (none) * IPv4: 10.0.1.160 * Trying 10.0.1.160:80... * Established connection to ip-160.yourdomain.com (10.0.1.160 port 80) from 10.0.1.121 port 64799 * using HTTP/1.x \u003e GET / HTTP/1.1 \u003e Host: ip-160.yourdomain.com \u003e User-Agent: curl/8.17.0 \u003e Accept: */* \u003e * Request completely sent off \u003c HTTP/1.1 302 Found HTTP/1.1 302 Found \u003c location: https://ip-160.yourdomain.com:443/ location: https://ip-160.yourdomain.com:443/ \u003c date: Mon, 05 Jan 2026 00:19:16 GMT date: Mon, 05 Jan 2026 00:19:16 GMT \u003c server: envoy server: envoy \u003c content-length: 0 content-length: 0 * Ignoring the response-body * setting size while ignoring \u003c * Connection #0 to host ip-160.yourdomain.com:80 left intact * Clear auth, redirects to port from 80 to 443 * Issue another request to this URL: 'https://ip-160.yourdomain.com:443/' * Host ip-160.yourdomain.com:443 was resolved. * IPv6: (none) * IPv4: 10.0.1.160 * Trying 10.0.1.160:443... * ALPN: curl offers h2,http/1.1 * TLSv1.3 (OUT), TLS handshake, Client hello (1): * SSL Trust Anchors: * Native: Apple SecTrust * OpenSSL default paths (fallback) * TLSv1.3 (IN), TLS handshake, Server hello (2): * TLSv1.3 (IN), TLS change cipher, Change cipher spec (1): * TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8): * TLSv1.3 (IN), TLS handshake, Certificate (11): * TLSv1.3 (IN), TLS handshake, CERT verify (15): * TLSv1.3 (IN), TLS handshake, Finished (20): * TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1): * TLSv1.3 (OUT), TLS handshake, Finished (20): * SSL connection using TLSv1.3 / TLS_CHACHA20_POLY1305_SHA256 / x25519 / RSASSA-PSS * ALPN: server did not agree on a protocol. Uses default. * Server certificate: * subject: CN=yourdomain.com * start date: Jan 3 06:20:30 2026 GMT * expire date: Apr 3 06:20:29 2026 GMT * issuer: C=US; O=Let's Encrypt; CN=R13 * Certificate level 0: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption * Certificate level 1: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption * Certificate level 2: Public key type RSA (4096/152 Bits/secBits), signed using sha256WithRSAEncryption * subjectAltName: \"ip-160.yourdomain.com\" matches cert's \"*.yourdomain.com\" * SSL certificate verified via OpenSSL. * Established connection to ip-160.yourdomain.com (10.0.1.160 port 443) from 10.0.1.121 port 64800 * using HTTP/1.x \u003e GET / HTTP/1.1 \u003e Host: ip-160.yourdomain.com \u003e User-Agent: curl/8.17.0 \u003e Accept: */* \u003e * Request completely sent off * TLSv1.3 (IN), TLS handshake, Newsession Ticket (4): * TLSv1.3 (IN), TLS handshake, Newsession Ticket (4): \u003c HTTP/1.1 200 OK HTTP/1.1 200 OK \u003c server: envoy server: envoy \u003c date: Mon, 05 Jan 2026 00:19:17 GMT date: Mon, 05 Jan 2026 00:19:17 GMT \u003c content-type: text/html content-type: text/html \u003c content-length: 615 content-length: 615 \u003c last-modified: Tue, 28 Oct 2025 12:05:10 GMT last-modified: Tue, 28 Oct 2025 12:05:10 GMT \u003c etag: \"6900b176-267\" etag: \"6900b176-267\" \u003c accept-ranges: bytes accept-ranges: bytes \u003c x-envoy-upstream-service-time: 1 x-envoy-upstream-service-time: 1 \u003c \u003c!DOCTYPE html\u003e Welcome to nginx! Welcome to nginx! If you see this page, the nginx web server is successfully installed and working. Further configuration is required.\nFor online documentation and support please refer to nginx.org. Commercial support is available at nginx.com.\nThank you for using nginx.\n* Connection #1 to host ip-160.yourdomain.com:443 left intact Potential Problems curl to your http port doesn’t get redirected You curl to the http port of your host and instead of getting redirected, you see the nginx welcome page.\nMake sure you deleted the old route before you added the redirect. Check with kubectl get httproute --all-namespaces if you see both of them as here\n$ kubectl get httproute -A NAMESPACE NAME HOSTNAMES AGE default http-to-https-redirect 117s playground playground-http-route [\"ip-160.yourdomain.com\"] 200s playground playground-ssl-route [\"ip-160.yourdomain.com\"] 200s Run kubectl delete httproute playground-http-route -n playground and try again.\n",
  "wordCount" : "2833",
  "inLanguage": "en",
  "image": "http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished": "2026-01-04T15:17:37-07:00",
  "dateModified": "2026-01-04T15:17:37-07:00",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/homelab/k8s/02-k8s-cilium-r53-and-cert-manager/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "unixorn.github.io",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                <img src="http://localhost:1313/apple-touch-icon.png" alt="" aria-label="logo"
                    height="35">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="about">
                    <span>about</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/projects/" title="projects">
                    <span>projects</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://hachyderm.io/@unixorn" title="hachyderm.io/@unixorn">
                    <span>hachyderm.io/@unixorn</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">
<link rel="stylesheet" type="text/css" href="http://localhost:1313/css/mastodon.css" />
<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/post/">Posts</a></div>
    <h1 class="post-title">
      Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53<sup><span class="entry-isdraft">&nbsp;&nbsp;[draft]</span></sup>
    </h1>
    <div class="post-meta"><span title='2026-01-04 15:17:37 -0700 MST'>January 4, 2026</span>&nbsp;·&nbsp;14 min&nbsp;·&nbsp;2833 words&nbsp;·&nbsp;Me

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#talos-homelab-setup-series">Talos Homelab Setup Series</a></li>
    <li><a href="#pre-requisites">Pre-requisites</a>
      <ul>
        <li><a href="#software-versions">Software Versions</a></li>
      </ul>
    </li>
    <li><a href="#instructions">Instructions</a>
      <ul>
        <li><a href="#create-an-aws-user-for-cert-manager">Create an AWS user for cert-manager</a></li>
        <li><a href="#install-cert-manager">Install cert-manager</a></li>
        <li><a href="#configure-cert-manager">Configure cert-manager</a></li>
      </ul>
    </li>
    <li><a href="#create-a-playground-workload">Create a playground workload</a></li>
    <li><a href="#configure-cilium">Configure Cilium</a>
      <ul>
        <li><a href="#create-a-gateway">Create a Gateway</a></li>
        <li><a href="#create-httproutes">Create HTTPRoutes</a></li>
      </ul>
    </li>
    <li><a href="#apply-and-test">Apply and test</a></li>
    <li><a href="#bonus---create-an-http---https-redirect">Bonus - create an http -&gt; https redirect</a>
      <ul>
        <li><a href="#update-our-httproutes">Update our HTTProutes</a></li>
      </ul>
    </li>
    <li><a href="#potential-problems">Potential Problems</a>
      <ul>
        <li><a href="#curl-to-your-http-port-doesnt-get-redirected"><code>curl</code> to your http port doesn’t get redirected</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>In part two of this homelab kubernetes setup series, we&rsquo;re going to install &amp; configure <a href="https://cert-manager.io/">cert-manager</a> to use <a href="https://letsencrypt.org">LetsEncrypt</a> with <a href="https://aws.amazon.com/route53/">Route 53</a> so we can use SSL to connect to our services.</p>
<p>The tutorials I&rsquo;ve seen for using cert-manager with a DNS challenge all use CloudFlare. I have my lab domain on <a href="https://aws.amazon.com/route53/">Route 53</a> so this post will cover that instead.</p>
<h2 id="talos-homelab-setup-series">Talos Homelab Setup Series<a hidden class="anchor" aria-hidden="true" href="#talos-homelab-setup-series">#</a></h2>
<ul>
<li><a href="../01-talos-with-cilium-cni-on-proxmox/">01 - Setting up Talos with a Cilium CNI on proxmox</a></li>
<li>02 - Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53</li>
</ul>
<h2 id="pre-requisites">Pre-requisites<a hidden class="anchor" aria-hidden="true" href="#pre-requisites">#</a></h2>
<ul>
<li>A domain hosted on Amazon Route 53 that you have administrative rights on.</li>
<li>A working kubernetes cluster with Cilium installed and configured to be a Gateway. I&rsquo;m using <a href="https://www.talos.dev/">Talos</a> for mine, but regular <a href="https://kubernetes.io">kubernetes</a> or <a href="https://k3s.io">k3s</a> clusters will work too. If you need to set up a new cluster, or configure an existing one to use Cilum, read <a href="(../01-talos-with-cilium-cni-on-proxmox/)">part one</a> of this series.</li>
<li><code>cilium</code>, <code>kubectl</code> &amp; <code>helm</code> - if you don&rsquo;t want to <code>brew install</code> them, install instructions are at <a href="https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#install-the-cilium-cli">cilium.io</a>, <a href="https://helm.sh">helm.sh</a> and <a href="https://kubernetes.io/docs/tasks/tools/">kubectl</a>.</li>
</ul>
<h3 id="software-versions">Software Versions<a hidden class="anchor" aria-hidden="true" href="#software-versions">#</a></h3>
<p>Here are the versions of the software I used while writing this post. Later versions should work, but this is what these instructions were tested with.</p>
<table>
  <thead>
      <tr>
          <th>Software</th>
          <th>Version</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>cert-manager</code></td>
          <td>1.19.2</td>
      </tr>
      <tr>
          <td><code>helm</code></td>
          <td>4.0.1</td>
      </tr>
      <tr>
          <td><code>kubectl</code></td>
          <td>1.34</td>
      </tr>
      <tr>
          <td><code>kubernetes</code></td>
          <td>1.34.1</td>
      </tr>
      <tr>
          <td><code>talos</code></td>
          <td>1.11.5</td>
      </tr>
  </tbody>
</table>
<h2 id="instructions">Instructions<a hidden class="anchor" aria-hidden="true" href="#instructions">#</a></h2>
<p>I don&rsquo;t have any services exposed to the internet, and I&rsquo;m not interested in exposing a web server just to answer HTTP queries by <code>LetsEncrypt</code>.</p>
<p>Here&rsquo;s how to configure <code>cert-manager</code> to use a DNS01 challenge with LetsSencrypt instead of an HTTP one. This will let <code>LetsEncrypt</code> validate ownership of your domain by checking for DNS records created/updated by <code>cert-manager</code> during certificate creation and renewal. As a bonus, using DNS challenges also lets you create wildcard certificates for your domain.</p>
<h3 id="create-an-aws-user-for-cert-manager">Create an AWS user for cert-manager<a hidden class="anchor" aria-hidden="true" href="#create-an-aws-user-for-cert-manager">#</a></h3>
<p>To validate certificate requests via DNS, <code>cert-manager</code> is going to need to use AWS credentials that have privilege to update DNS domains. <em>Do not use your root IAM account!</em> You should only ever use your root IAM account to create users that have the minimum privilege they need for explicit tasks. So instead, we&rsquo;re going to create a user with access limited to updating domains hosted on Route 53.</p>
<h4 id="create-an-iam-policy">Create an IAM policy<a hidden class="anchor" aria-hidden="true" href="#create-an-iam-policy">#</a></h4>
<p>First create a policy that grants control over Route53. Log in to the AWS console and select <strong>Identity and Access Management (IAM)</strong>, then select <strong>Policies</strong> from the sidebar, and finally, hit the <strong>Create Policy</strong> button.</p>
<p>Creating the policy first makes it easier to attach to an IAM group when we create one in the next step.</p>
<p>I&rsquo;ve already created a working policy, so instead of manually adding permissions, click <strong>JSON</strong> to the right of where it says <strong>Policy Editor</strong> and paste in this JSON snippet</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="s2">&#34;route53:ListHostedZonesByName&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="s2">&#34;*&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;route53:ChangeResourceRecordSets&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;route53:ListResourceRecordSets&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;route53:GetHostedZone&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:route53:::hostedzone/YOUR_DOMAINS_ZONE_ID&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>As of 2026-01-03, it should look like this:</p>
<p><img alt="policyedit" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/iam-r53-permissions.png#center"></p>
<p>Click <strong>Next</strong>, and give your new policy a name and a description, for example <code>blog-letsencrypt</code>.</p>
<h4 id="create-an-iam-group">Create an IAM group<a hidden class="anchor" aria-hidden="true" href="#create-an-iam-group">#</a></h4>
<p>You could attach a policy to a user, but using a group makes it easier to create other users with this set of permissions. I have a different IAM user that I use for <code>nginx-proxy-manager</code> on my standalone hosts, and I also use different users for my dev and prod clusters.</p>
<p>Now create a group, click <strong>User Groups</strong> in the side bar, then hit the <strong>Create Group</strong> button.
Give it a name like <code>blog-le-users</code>.</p>
<p><img alt="create_iam_group" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/02-iam-create-blog-le-users-group.png#center"></p>
<p>Under <em>Attach permissions policy</em>* select the <code>blog-letsencrypt</code> policy you just created.</p>
<p><img alt="add_iam_policy" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/03-iam-attach-policy.png#center"></p>
<p>Hit the <strong>Create Group</strong> button on the bottom right of the page.</p>
<h4 id="create-an-iam-user">Create an IAM user<a hidden class="anchor" aria-hidden="true" href="#create-an-iam-user">#</a></h4>
<p>Now that the group and policy are created, you can finally create your R53 IAM user. Click <strong>Users</strong> in the side bar, then click the <strong>Add Users</strong> button on the right side of the screen.</p>
<p>Give it a name like <code>r53-acme-user</code> and click <strong>Next</strong>.</p>
<p><img alt="add_iam_user" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/04-create-acme-user.png#center"></p>
<p>Don&rsquo;t check the <code>Provide user access to the AWS Management Console</code> checkbox, this user will only be used by <code>cert-manager</code>. Select the <code>blog-le-users</code> group</p>
<p><img alt="add_user_to_group" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/05-add-user-to-group.png#center"></p>
<p>Click <strong>Next</strong> again.</p>
<p>You&rsquo;ll see a review and create page:</p>
<p><img alt="review_and_create" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/06-review-and-create.png#center"></p>
<p>Click <strong>Create user</strong> on the bottom right of the page.</p>
<p>One last thing - you&rsquo;ll need to create access credentials for the user. Click on Users in the side bar again, then your brand new <code>r53-acme-user</code> user.</p>
<p>You&rsquo;ll see an info page about the user, click the <strong>Security Credentials</strong> tab</p>
<p><img alt="security_credentials" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/07-security-credentials.png#center"></p>
<p>Scroll down to <strong>Access Keys</strong>, and click <strong>Create access key</strong>.</p>
<p><img alt="access_key" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/08-create-access-key.png#center"></p>
<p>Click <strong>Other</strong> on the next page</p>
<p><img alt="other" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/09-pick-other.png#center"></p>
<p>Click <strong>Next</strong>. Put in <code>letsencrypt</code> for the description,and click <strong>Create access key</strong> again.</p>
<p>You&rsquo;ll see something like</p>
<p><img alt="other" loading="lazy" src="http://localhost:1313/images/nginx-proxy-manager/10-retrieve-access-keys.png#center"></p>
<p>You only get one chance to see the secret key, so store it in your password manager. It isn&rsquo;t a huge deal if you lose it, you can always create another access key for your user. Copy the access key &amp; secret keys into your password manager for later use.</p>
<h3 id="install-cert-manager">Install cert-manager<a hidden class="anchor" aria-hidden="true" href="#install-cert-manager">#</a></h3>
<p>We&rsquo;re going to use <code>helm</code> to install <code>cert-manager</code>, so first we need to add its helm repository.</p>
<h4 id="add-the-jetstack-repo">Add the Jetstack repo<a hidden class="anchor" aria-hidden="true" href="#add-the-jetstack-repo">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">helm repo add jetstack https://charts.jetstack.io <span class="o">&amp;&amp;</span> helm repo update
</span></span></code></pre></div><h4 id="get-the-helm-repository-gpg-keyring">Get the helm repository gpg keyring<a hidden class="anchor" aria-hidden="true" href="#get-the-helm-repository-gpg-keyring">#</a></h4>
<p>The <code>cert-manager</code> team provides a gpg keyring to validate the helm chart when we install it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -LO https://cert-manager.io/public-keys/cert-manager-keyring-2021-09-20-1020CF3C033D4F35BAE1C19E1226061C665DF13E.gpg
</span></span></code></pre></div><h4 id="install-certmanager-and-the-crds-it-needs">Install cert‑manager and the CRDs it needs<a hidden class="anchor" aria-hidden="true" href="#install-certmanager-and-the-crds-it-needs">#</a></h4>
<p>Now that we have AWS credentials set up, let&rsquo;s use <code>helm</code> to create a <code>cert-manager</code> namespace, verify the chart using the gpg keyring and install <code>cert-manager</code> along with the CRDs it needs.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">helm install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  cert-manager oci://quay.io/jetstack/charts/cert-manager <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --version v1.19.2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --namespace cert-manager <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --create-namespace <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --keyring ./cert-manager-keyring-2021-09-20-1020CF3C033D4F35BAE1C19E1226061C665DF13E.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --verify <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set crds.enabled<span class="o">=</span><span class="nb">true</span>
</span></span></code></pre></div><h4 id="confirm-installation-with-helm-list">Confirm installation with helm list<a hidden class="anchor" aria-hidden="true" href="#confirm-installation-with-helm-list">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">helm list --all-namespaces
</span></span></code></pre></div><p>You should see something like</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">NAME        	NAMESPACE   	REVISION	UPDATED                             	STATUS  	CHART               	APP VERSION
</span></span><span class="line"><span class="cl">cert-manager	cert-manager	1       	2026-01-03 22:42:45.78814 -0700 MST 	deployed	cert-manager-v1.19.2	v1.19.2
</span></span></code></pre></div><h3 id="configure-cert-manager">Configure cert-manager<a hidden class="anchor" aria-hidden="true" href="#configure-cert-manager">#</a></h3>
<h4 id="create-an-aws-credential-secret">Create an AWS credential secret<a hidden class="anchor" aria-hidden="true" href="#create-an-aws-credential-secret">#</a></h4>
<p>Setting up an external secret provider is out of scope for this post. We&rsquo;re going to store the AWS credentials in a secret.</p>
<p>For tidiness, we&rsquo;re going to put all the <code>cert-manager</code> confguration yaml files in a <code>cert-manager</code> directory, so <code>mkdir cert-manager</code>.</p>
<p>Create a <code>cert-manager/aws-secret.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">route53-aws-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">cert-manager</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Opaque</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">stringData</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Replace these with your actual keys (or use a Kubernetes external secret provider)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">access-key-id</span><span class="p">:</span><span class="w"> </span><span class="l">YOUR_R53_IAM_USER_AWS_ACCESS_KEY_ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">secret-access-key</span><span class="p">:</span><span class="w"> </span><span class="l">YOUR_R53_IAM_USER_AWS_SECRET_ACCESS_KEY</span><span class="w">
</span></span></span></code></pre></div><h4 id="create-a-clusterissuer">Create a <code>ClusterIssuer</code><a hidden class="anchor" aria-hidden="true" href="#create-a-clusterissuer">#</a></h4>
<p>Create <code>cert-manager/cluster-issuer.yaml</code>. Make sure you set the email field to your real email so LetsEncrypt can notify you about policy changes or issues.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">cert-manager.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIssuer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">letsencrypt-dns-r53</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">acme</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Use the production server for real certificates; switch to the staging URL while testing.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l">https://acme-v02.api.letsencrypt.org/directory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># staging: https://acme-staging-v02.api.letsencrypt.org/directory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">email</span><span class="p">:</span><span class="w"> </span><span class="l">your@email.example  </span><span class="w"> </span><span class="c"># &lt;-- change to your real contact address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">privateKeySecretRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">letsencrypt-dns-r53-account-key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">solvers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">dns01</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">route53</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l">us-east-1              </span><span class="w"> </span><span class="c"># Region where your hosted zone lives</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">hostedZoneID</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="c"># Articles I read said this was optional, but when I left it empty cert‑manager didn&#39;t discover it and my certs never came ready</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">accessKeyIDSecretRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">route53-aws-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">access-key-id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">secretAccessKeySecretRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">route53-aws-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">secret-access-key</span><span class="w">
</span></span></span></code></pre></div><h4 id="apply-the-configuration">Apply the configuration<a hidden class="anchor" aria-hidden="true" href="#apply-the-configuration">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl apply -f cert-manager <span class="c1"># Apply all the yaml files in the directory</span>
</span></span></code></pre></div><h4 id="confirm-that-the-clusterissuer-is-working">Confirm that the <code>ClusterIssuer</code> is working<a hidden class="anchor" aria-hidden="true" href="#confirm-that-the-clusterissuer-is-working">#</a></h4>
<p>Create a standlone certificate with the <code>ClusterIssuer</code> so that we can confirm that LetsEncrypt is working before we try to use it with an <code>Ingress</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># standalone-certificate.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">cert-manager.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Certificate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">wildcard-yourdomain-com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">yourdomain-com-tls</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">dnsNames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s1">&#39;yourdomain.com&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s1">&#39;*.yourdomain.com&#39;</span><span class="w"> </span><span class="c"># This is a homelab, so I&#39;m ok with using a wildcard certificate for all my services</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">issuerRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">letsencrypt-dns-r53</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIssuer</span><span class="w">
</span></span></span></code></pre></div><p>Make sure the <code>secretName</code> is unique to this certificate or you&rsquo;ll get mysterious breakages, then apply it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl apply -f standalone-certificate.yaml
</span></span></code></pre></div><p>Wait a few seconds, then run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl get certificate --all-namespaces
</span></span></code></pre></div><p>You should see something like</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">NAMESPACE   NAME                          READY   SECRET                            AGE
</span></span><span class="line"><span class="cl">default     wildcard-yourdomain-com-cert  True    yourdomain-com--tls.              1m
</span></span></code></pre></div><p>The first time I made a certificate it took almost a minute, so don&rsquo;t assume things are broken if the certificate doesn&rsquo;t show as ready right away.</p>
<p>Behind the scenes, cert-manager is creating a certificate, creating the required DNS entries, posting an ACME request to LetsEncrypt, waiting for LetsEncrypt to verify the DNS records and sign your certificate, and then finally loading the signed certfificate. It can take a literal minute if LetsEncrypt is busy.</p>
<p>If you run <code>kubectl describe certificate wildcard-your-domain-com</code> you should see something like this:</p>
<pre tabindex="0"><code>Name:         wildcard-your-domain-cert
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  cert-manager.io/v1
Kind:         Certificate
Metadata:
  Creation Timestamp:  2026-01-03T07:18:54Z
  Generation:          1
  Resource Version:    225621
  UID:                 12345678-90AB-CDEFGHIJK-LMNOPQRSTUVW
Spec:
  Dns Names:
    www.yourdomain.com
  Issuer Ref:
    Kind:       ClusterIssuer
    Name:       letsencrypt-dns-r53
  Secret Name:  your-domain-com-tls
Status:
  Conditions:
    Last Transition Time:  2026-01-03T07:19:02Z
    Message:               Certificate is up to date and has not expired
    Observed Generation:   1
    Reason:                Ready
    Status:                True
    Type:                  Ready
  Not After:               2026-04-03T06:20:29Z
  Not Before:              2026-01-03T06:20:30Z
  Renewal Time:            2026-03-04T06:20:29Z
  Revision:                1
Events:                    &lt;none&gt;
</code></pre><p>Great, the cert exists and has ready status, now to test it.</p>
<h2 id="create-a-playground-workload">Create a playground workload<a hidden class="anchor" aria-hidden="true" href="#create-a-playground-workload">#</a></h2>
<p>Create a playground directory, and create <code>playground/01-playground-nginx.yaml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># 01-playground-nginx.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Create the playground namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kubernetes.io/metadata.name</span><span class="p">:</span><span class="w"> </span><span class="l">playground</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Create an nginx deployment.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-nginx-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">playground</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">playground-nginx-pod </span><span class="w"> </span><span class="c"># &lt;-- must match pod labels exactly</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">playground-nginx-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Talos is very security oriented, so we have to set up the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># security context explicitly</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># ---------- Pod‑level security settings ----------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="m">101</span><span class="w"> </span><span class="c"># non‑root UID that the image can run as</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">seccompProfile</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RuntimeDefault</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># Uncomment if you need a shared FS group for volume writes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># fsGroup: 101</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># ---------- Containers ----------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-playground-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginxinc/nginx-unprivileged:latest</span><span class="w"> </span><span class="c"># Alpine, but we force a non‑root UID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># talos requires us to specify our resources instead of</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># letting k8s YOLO them</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;64Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;250m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;128Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;500m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="l">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># And finally, create a service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-nginx-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">playground</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">playground-nginx-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># This is what the service is listening on, and what will be routed to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w"> </span><span class="c"># Port the pods are listening on, don&#39;t route directly here!</span><span class="w">
</span></span></span></code></pre></div><h2 id="configure-cilium">Configure Cilium<a hidden class="anchor" aria-hidden="true" href="#configure-cilium">#</a></h2>
<h3 id="create-a-gateway">Create a Gateway<a hidden class="anchor" aria-hidden="true" href="#create-a-gateway">#</a></h3>
<p>We&rsquo;re going to create a gateway that listens to both HTTP and HTTPS traffic. Create <code>playground/02-playground-gateway</code></p>
<p>We&rsquo;re specifying a specific IP address from our pool so that it stays static and we can create a DNS entry for it</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># 02-playground-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Note - we are _not_ putting this in a namespace so our workloads can</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># share it.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l">cilium</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">addresses</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">IPAddress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.1.160</span><span class="w"> </span><span class="c"># Force the gateway to grab a specific IP from the pool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allowedRoutes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespaces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l">All</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allowedRoutes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespaces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l">All</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">certificateRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">yourdomain-com-tls</span><span class="w">
</span></span></span></code></pre></div><p>Create the gateway now so you can find out what IP address it gets.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl apply -f playground/02-playground-gateway.yaml <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  kubectl get gateway --all-namespaces
</span></span></code></pre></div><p>You&rsquo;ll see something like</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">NAMESPACE   NAME                 CLASS    ADDRESS      PROGRAMMED   AGE
</span></span><span class="line"><span class="cl">default     playground-gateway   cilium   10.0.1.160   True         1h
</span></span></code></pre></div><p>For the rest of these instructions, we&rsquo;re going to assume your gateway is <code>10.0.1.160</code>.</p>
<p>Go to Amazon&rsquo;s R53 control panel and create an A record in your domain, <code>ip-160.yourdomain.com</code> with the address <code>10.0.1.160</code>.</p>
<h3 id="create-httproutes">Create HTTPRoutes<a hidden class="anchor" aria-hidden="true" href="#create-httproutes">#</a></h3>
<p>We&rsquo;re going to create two HTTPRoutes, one for HTTP and one for HTTPS. Create <code>playground/03-httproutes.yaml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># 03-httproutes.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRoute</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-http-route</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">playground</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sectionName</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hostnames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;ip-160.yourdomain.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">backendRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-nginx-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRoute</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-ssl-route</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">playground</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sectionName</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hostnames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;ip-160.yourdomain.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">backendRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-nginx-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></div><h2 id="apply-and-test">Apply and test<a hidden class="anchor" aria-hidden="true" href="#apply-and-test">#</a></h2>
<p>Now we&rsquo;re finally ready to create our routes</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl apply -f playground <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  kubectl get gateway <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  kubectl get httproute --all-namespaces
</span></span></code></pre></div><p>You should see something like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">NAME                 CLASS    ADDRESS      PROGRAMMED   AGE
</span></span><span class="line"><span class="cl">playground-gateway   cilium   10.0.1.160   True         23h
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAMESPACE    NAME                    HOSTNAMES                             AGE
</span></span><span class="line"><span class="cl">playground   playground-http-route   <span class="o">[</span><span class="s2">&#34;ip-160.yourdomain.com&#34;</span><span class="o">]</span>             3m
</span></span><span class="line"><span class="cl">playground   playground-ssl-route    <span class="o">[</span><span class="s2">&#34;ip-160.yourdomain.com&#34;</span><span class="o">]</span>             3m
</span></span></code></pre></div><p>You should now see the <code>Welcome to nginx!</code> page when you go to either <code>http://ip-160.yourdomain.com</code> or <code>https://ip-160.yourdomain.com</code>.</p>
<h2 id="bonus---create-an-http---https-redirect">Bonus - create an http -&gt; https redirect<a hidden class="anchor" aria-hidden="true" href="#bonus---create-an-http---https-redirect">#</a></h2>
<p>If I go to the http url instead of https, I want to be automagically redirected to https so I don&rsquo;t accidentally send any login credentials on an unencrypted connection.</p>
<h3 id="update-our-httproutes">Update our HTTProutes<a hidden class="anchor" aria-hidden="true" href="#update-our-httproutes">#</a></h3>
<p>Our gateway is already configured to listen on both http and https, so we&rsquo;re going to create an <code>HTTPRoute</code> that listens on port 80 and redirects any hits to port 443.</p>
<p>Create <code>playground/04-redirect-http-to-https.yaml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># 04-redirect-http-to-https.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRoute</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http-to-https-redirect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">playground-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sectionName</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RequestRedirect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">requestRedirect</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span></code></pre></div><p>Now let&rsquo;s replace the old http route</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl delete httproute playground-http-route -n playground <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  kubectl apply -f playground/04-redirect-http-to-https.yaml <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  curl -iv ip160.yourdomain.com
</span></span></code></pre></div><p>You should see something like this - on line 14 you can see it get a 302 and on line 29 it opens a new connection to port 443.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">* Host ip-160.yourdomain.com:80 was resolved.
</span></span><span class="line"><span class="cl">* IPv6: (none)
</span></span><span class="line"><span class="cl">* IPv4: 10.0.1.160
</span></span><span class="line"><span class="cl">*   Trying 10.0.1.160:80...
</span></span><span class="line"><span class="cl">* Established connection to ip-160.yourdomain.com (10.0.1.160 port 80) from 10.0.1.121 port 64799
</span></span><span class="line"><span class="cl">* using HTTP/1.x
</span></span><span class="line"><span class="cl">&gt; GET / HTTP/1.1
</span></span><span class="line"><span class="cl">&gt; Host: ip-160.yourdomain.com
</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/8.17.0
</span></span><span class="line"><span class="cl">&gt; Accept: */*
</span></span><span class="line"><span class="cl">&gt;
</span></span><span class="line"><span class="cl">* Request completely sent off
</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 302 Found
</span></span><span class="line"><span class="cl">HTTP/1.1 302 Found
</span></span><span class="line"><span class="cl">&lt; location: https://ip-160.yourdomain.com:443/
</span></span><span class="line"><span class="cl">location: https://ip-160.yourdomain.com:443/
</span></span><span class="line"><span class="cl">&lt; date: Mon, 05 Jan 2026 00:19:16 GMT
</span></span><span class="line"><span class="cl">date: Mon, 05 Jan 2026 00:19:16 GMT
</span></span><span class="line"><span class="cl">&lt; server: envoy
</span></span><span class="line"><span class="cl">server: envoy
</span></span><span class="line"><span class="cl">&lt; content-length: 0
</span></span><span class="line"><span class="cl">content-length: 0
</span></span><span class="line"><span class="cl">* Ignoring the response-body
</span></span><span class="line"><span class="cl">* setting size while ignoring
</span></span><span class="line"><span class="cl">&lt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* Connection #0 to host ip-160.yourdomain.com:80 left intact
</span></span><span class="line"><span class="cl">* Clear auth, redirects to port from 80 to 443
</span></span><span class="line"><span class="cl">* Issue another request to this URL: &#39;https://ip-160.yourdomain.com:443/&#39;
</span></span><span class="line"><span class="cl">* Host ip-160.yourdomain.com:443 was resolved.
</span></span><span class="line"><span class="cl">* IPv6: (none)
</span></span><span class="line"><span class="cl">* IPv4: 10.0.1.160
</span></span><span class="line"><span class="cl">*   Trying 10.0.1.160:443...
</span></span><span class="line"><span class="cl">* ALPN: curl offers h2,http/1.1
</span></span><span class="line"><span class="cl">* TLSv1.3 (OUT), TLS handshake, Client hello (1):
</span></span><span class="line"><span class="cl">* SSL Trust Anchors:
</span></span><span class="line"><span class="cl">*   Native: Apple SecTrust
</span></span><span class="line"><span class="cl">*   OpenSSL default paths (fallback)
</span></span><span class="line"><span class="cl">* TLSv1.3 (IN), TLS handshake, Server hello (2):
</span></span><span class="line"><span class="cl">* TLSv1.3 (IN), TLS change cipher, Change cipher spec (1):
</span></span><span class="line"><span class="cl">* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
</span></span><span class="line"><span class="cl">* TLSv1.3 (IN), TLS handshake, Certificate (11):
</span></span><span class="line"><span class="cl">* TLSv1.3 (IN), TLS handshake, CERT verify (15):
</span></span><span class="line"><span class="cl">* TLSv1.3 (IN), TLS handshake, Finished (20):
</span></span><span class="line"><span class="cl">* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
</span></span><span class="line"><span class="cl">* TLSv1.3 (OUT), TLS handshake, Finished (20):
</span></span><span class="line"><span class="cl">* SSL connection using TLSv1.3 / TLS_CHACHA20_POLY1305_SHA256 / x25519 / RSASSA-PSS
</span></span><span class="line"><span class="cl">* ALPN: server did not agree on a protocol. Uses default.
</span></span><span class="line"><span class="cl">* Server certificate:
</span></span><span class="line"><span class="cl">*   subject: CN=yourdomain.com
</span></span><span class="line"><span class="cl">*   start date: Jan  3 06:20:30 2026 GMT
</span></span><span class="line"><span class="cl">*   expire date: Apr  3 06:20:29 2026 GMT
</span></span><span class="line"><span class="cl">*   issuer: C=US; O=Let&#39;s Encrypt; CN=R13
</span></span><span class="line"><span class="cl">*   Certificate level 0: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">*   Certificate level 1: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">*   Certificate level 2: Public key type RSA (4096/152 Bits/secBits), signed using sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">*   subjectAltName: &#34;ip-160.yourdomain.com&#34; matches cert&#39;s &#34;*.yourdomain.com&#34;
</span></span><span class="line"><span class="cl">* SSL certificate verified via OpenSSL.
</span></span><span class="line"><span class="cl">* Established connection to ip-160.yourdomain.com (10.0.1.160 port 443) from 10.0.1.121 port 64800
</span></span><span class="line"><span class="cl">* using HTTP/1.x
</span></span><span class="line"><span class="cl">&gt; GET / HTTP/1.1
</span></span><span class="line"><span class="cl">&gt; Host: ip-160.yourdomain.com
</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/8.17.0
</span></span><span class="line"><span class="cl">&gt; Accept: */*
</span></span><span class="line"><span class="cl">&gt;
</span></span><span class="line"><span class="cl">* Request completely sent off
</span></span><span class="line"><span class="cl">* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
</span></span><span class="line"><span class="cl">* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">&lt; server: envoy
</span></span><span class="line"><span class="cl">server: envoy
</span></span><span class="line"><span class="cl">&lt; date: Mon, 05 Jan 2026 00:19:17 GMT
</span></span><span class="line"><span class="cl">date: Mon, 05 Jan 2026 00:19:17 GMT
</span></span><span class="line"><span class="cl">&lt; content-type: text/html
</span></span><span class="line"><span class="cl">content-type: text/html
</span></span><span class="line"><span class="cl">&lt; content-length: 615
</span></span><span class="line"><span class="cl">content-length: 615
</span></span><span class="line"><span class="cl">&lt; last-modified: Tue, 28 Oct 2025 12:05:10 GMT
</span></span><span class="line"><span class="cl">last-modified: Tue, 28 Oct 2025 12:05:10 GMT
</span></span><span class="line"><span class="cl">&lt; etag: &#34;6900b176-267&#34;
</span></span><span class="line"><span class="cl">etag: &#34;6900b176-267&#34;
</span></span><span class="line"><span class="cl">&lt; accept-ranges: bytes
</span></span><span class="line"><span class="cl">accept-ranges: bytes
</span></span><span class="line"><span class="cl">&lt; x-envoy-upstream-service-time: 1
</span></span><span class="line"><span class="cl">x-envoy-upstream-service-time: 1
</span></span><span class="line"><span class="cl">&lt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;style&gt;
</span></span><span class="line"><span class="cl">html { color-scheme: light dark; }
</span></span><span class="line"><span class="cl">body { width: 35em; margin: 0 auto;
</span></span><span class="line"><span class="cl">font-family: Tahoma, Verdana, Arial, sans-serif; }
</span></span><span class="line"><span class="cl">&lt;/style&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span class="line"><span class="cl">working. Further configuration is required.&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;p&gt;For online documentation and support please refer to
</span></span><span class="line"><span class="cl">&lt;a href=&#34;http://nginx.org/&#34;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span class="line"><span class="cl">Commercial support is available at
</span></span><span class="line"><span class="cl">&lt;a href=&#34;http://nginx.com/&#34;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span><span class="line"><span class="cl">* Connection #1 to host ip-160.yourdomain.com:443 left intact
</span></span></code></pre></div><h2 id="potential-problems">Potential Problems<a hidden class="anchor" aria-hidden="true" href="#potential-problems">#</a></h2>
<h3 id="curl-to-your-http-port-doesnt-get-redirected"><code>curl</code> to your http port doesn&rsquo;t get redirected<a hidden class="anchor" aria-hidden="true" href="#curl-to-your-http-port-doesnt-get-redirected">#</a></h3>
<p>You curl to the http port of your host and instead of getting redirected, you see the nginx welcome page.</p>
<p>Make sure you deleted the old route before you added the redirect. Check with <code>kubectl get httproute --all-namespaces</code> if you see both of them as here</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get httproute -A
</span></span><span class="line"><span class="cl">NAMESPACE    NAME                     HOSTNAMES                             AGE
</span></span><span class="line"><span class="cl">default      http-to-https-redirect                                         117s
</span></span><span class="line"><span class="cl">playground   playground-http-route    <span class="o">[</span><span class="s2">&#34;ip-160.yourdomain.com&#34;</span><span class="o">]</span>             200s
</span></span><span class="line"><span class="cl">playground   playground-ssl-route     <span class="o">[</span><span class="s2">&#34;ip-160.yourdomain.com&#34;</span><span class="o">]</span>             200s
</span></span></code></pre></div><p>Run <code>kubectl delete httproute playground-http-route -n playground</code> and try again.</p>


  </div>
  <div>
    
  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/cert-manager/">Cert-Manager</a></li>
      <li><a href="http://localhost:1313/tags/homelab/">Homelab</a></li>
      <li><a href="http://localhost:1313/tags/k8s/">K8s</a></li>
      <li><a href="http://localhost:1313/tags/letsencrypt/">Letsencrypt</a></li>
      <li><a href="http://localhost:1313/tags/r53/">R53</a></li>
      <li><a href="http://localhost:1313/tags/ssl/">Ssl</a></li>
      <li><a href="http://localhost:1313/tags/talos/">Talos</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="http://localhost:1313/post/homelab/k8s/01-talos-with-cilium-cni-on-proxmox/">
    <span class="title">Next »</span>
    <br>
    <span>Creating a Talos kubernetes cluster with a Cilium CNI on Proxmox</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 on x"
            href="https://x.com/intent/tweet/?text=Add%20SSL%20to%20Kubernetes%20using%20Cilium%2c%20cert-manager%20and%20LetsEncrypt%20with%20domains%20hosted%20on%20Amazon%20Route%2053&amp;url=http%3a%2f%2flocalhost%3a1313%2fpost%2fhomelab%2fk8s%2f02-k8s-cilium-r53-and-cert-manager%2f&amp;hashtags=cert-manager%2chomelab%2ck8s%2cletsencrypt%2cr53%2cssl%2ctalos">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fpost%2fhomelab%2fk8s%2f02-k8s-cilium-r53-and-cert-manager%2f&amp;title=Add%20SSL%20to%20Kubernetes%20using%20Cilium%2c%20cert-manager%20and%20LetsEncrypt%20with%20domains%20hosted%20on%20Amazon%20Route%2053&amp;summary=Add%20SSL%20to%20Kubernetes%20using%20Cilium%2c%20cert-manager%20and%20LetsEncrypt%20with%20domains%20hosted%20on%20Amazon%20Route%2053&amp;source=http%3a%2f%2flocalhost%3a1313%2fpost%2fhomelab%2fk8s%2f02-k8s-cilium-r53-and-cert-manager%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fpost%2fhomelab%2fk8s%2f02-k8s-cilium-r53-and-cert-manager%2f&title=Add%20SSL%20to%20Kubernetes%20using%20Cilium%2c%20cert-manager%20and%20LetsEncrypt%20with%20domains%20hosted%20on%20Amazon%20Route%2053">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpost%2fhomelab%2fk8s%2f02-k8s-cilium-r53-and-cert-manager%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 on whatsapp"
            href="https://api.whatsapp.com/send?text=Add%20SSL%20to%20Kubernetes%20using%20Cilium%2c%20cert-manager%20and%20LetsEncrypt%20with%20domains%20hosted%20on%20Amazon%20Route%2053%20-%20http%3a%2f%2flocalhost%3a1313%2fpost%2fhomelab%2fk8s%2f02-k8s-cilium-r53-and-cert-manager%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 on telegram"
            href="https://telegram.me/share/url?text=Add%20SSL%20to%20Kubernetes%20using%20Cilium%2c%20cert-manager%20and%20LetsEncrypt%20with%20domains%20hosted%20on%20Amazon%20Route%2053&amp;url=http%3a%2f%2flocalhost%3a1313%2fpost%2fhomelab%2fk8s%2f02-k8s-cilium-r53-and-cert-manager%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Add SSL to Kubernetes using Cilium, cert-manager and LetsEncrypt with domains hosted on Amazon Route 53 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Add%20SSL%20to%20Kubernetes%20using%20Cilium%2c%20cert-manager%20and%20LetsEncrypt%20with%20domains%20hosted%20on%20Amazon%20Route%2053&u=http%3a%2f%2flocalhost%3a1313%2fpost%2fhomelab%2fk8s%2f02-k8s-cilium-r53-and-cert-manager%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>Copyright 2019-2024, Joe Block. All rights reserved.</span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
        <a rel="me" href="https://hachyderm.io/@unixorn">Mastodon</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
